{% extends 'flatpages/default.html' %}

{% load custom_filters %}


{% block title %}
Post
{% endblock title %}

{% block content %}
{% if request.user.is_authenticated %}
<a href="{% url 'account_logout' %}" >Выйти из аккаунта</a>
{% else %}
    <a href="{% url 'account_login' %}">Войти в аккаунт</a>
{% endif %}
<h3>Заголовок: {{ post.heading|censor }}</h3>
<h4>Дата публикации:{{ post.date_time_create|date:'d M Y' }}</h4>
<h5>Категория:{% for category in post.categoryPost.all %}
                        <a href="{% url 'category_list' category.id %}">{{ category }}</a>
                    {% endfor %}</h5>
<b>Содержание:</b>
<p>
    {{ post.content|censor }}
</p>
{% if perms.news.change_post %}
{% if post.author == request.user.author %}
<a href="{% url 'news_update' post.id %}">Изменить</a>
{% endif %}
{% endif %}
<hr>
<h2> Комментарии </h2>

     {% if user.is_authenticated %}
      <form action="" method="POST" id="main_form" class="comment_form">
         <div>
             <label>Введите Ваш комментарий здесь: </label>
            {{ comment_form.content_comment }} {% csrf_token %} <input type="submit" value="Отправить">
         </div>
         </div>
      </form>
      {% else %} <h2>Оставлять комментарии могут только зарегистрированные пользователи!</h2>
      {% endif %}

      {% for comment in comments %}
         {% if comment.is_parent %}
<font size="4"> <b>{{ comment.comment_user }} : </b> {{ comment.content_comment }}</font><br>
         <form action="" method="POST" class="comment_form">
            <div>
                &nbsp; &nbsp; &nbsp;<label>Ответить:</label>
               &nbsp; &nbsp; &nbsp;<input type="text" name="content_comment"> <input type="hidden" value="{{ comment.pk }}" name="parent"> {% csrf_token %} <input type="submit" value="Отправить">
            </div>
            </div>
         </form>
         {% endif %}
         {% for replies in comment.children %}
            <font size="3">&nbsp; &nbsp; &nbsp; <b>{{ replies.comment_user }} : </b> {{ replies.content_comment }}</font><br>
         {% endfor %}
      {% endfor %}


{% endblock content %}